from optimparallel import minimize_parallel
from pca import *
from readply import *
from main import toTuple
import numpy as np
import pandas as pd
import time
from scipy.optimize import minimize

sampleline = [
    [9.199999999999996, 5.769846525534513, -3.7846918495567485],
    [9.199999999999996, 5.822341623077467, -3.9420714015365275],
    [9.199999999999996, 5.87480487871648, -3.9420714015365275],
    [9.199999999999996, 5.927268134355613, -3.9420714015365275],
    [9.200000000000003, 5.927278605816285, -3.9945310622503736],
    [9.199999999999996, 5.927289077258143, -4.046990627991659],
    [9.199999999999996, 5.979752237918053, -4.046990627991659],
    [9.199999999999996, 5.979762661851389, -4.099450098760608],
    [9.199999999999996, 6.032225775021994, -4.099450098760608],
    [9.199999999999996, 6.084688888192474, -4.099450098760608],
    [9.20000000000001, 6.084699217128378, -4.151909474557434],
    [9.20000000000001, 6.137162282809525, -4.151909474557434],
    [9.20000000000001, 6.189625348490791, -4.151909474557434],
    [9.199999999999996, 6.189635582429398, -4.204368755382475],
    [9.199999999999996, 6.242098600621409, -4.204368755382475],
    [9.199999999999996, 6.2945616188133044, -4.204368755382475],
    [9.200000000000003, 6.294571757755147, -4.256827941235912],
    [9.200000000000003, 6.294581896678519, -4.309287032118081],
    [9.200000000000003, 6.347044819892165, -4.309287032118081],
    [9.199999999999996, 6.347054911308328, -4.361746028029199],
    [9.199999999999996, 6.399517787032982, -4.361746028029199],
    [9.20000000000001, 6.399527830941944, -4.414204928969483],
    [9.20000000000001, 6.451990659177687, -4.414204928969483],
    [9.20000000000001, 6.504453487413551, -4.414204928969483],
    [9.199999999999989, 6.5044634363265565, -4.466663734939236],
    [9.199999999999989, 6.556926217073599, -4.466663734939236],
    [9.199999999999996, 6.556936118479912, -4.519122445938794],
    [9.199999999999996, 6.6093988517380975, -4.519122445938794],
    [9.199999999999996, 6.609408705637904, -4.571581061968249],
    [9.199999999999996, 6.661871391407438, -4.571581061968249],
    [9.199999999999996, 6.661881197800838, -4.624039583027943],
    [9.199999999999996, 6.714343836081811, -4.624039583027943],
    [9.199999999999996, 6.7668064743629035, -4.624039583027943],
    [9.199999999999996, 6.766816185761474, -4.676498009118135],
    [9.199999999999996, 6.819278776554091, -4.676498009118135],
    [9.200000000000003, 6.819288440446739, -4.728956340239164],
    [9.200000000000003, 6.871750983750841, -4.728956340239164],
    [9.199999999999996, 6.871760600137753, -4.781414576391124],
    [9.199999999999996, 6.9242230959535505, -4.781414576391124],
    [9.199999999999996, 6.976685591769467, -4.781414576391124],
    [9.199999999999996, 6.976695113162412, -4.833872717574355],
    [9.199999999999996, 7.029157561490107, -4.833872717574355],
    [9.200000000000003, 7.02916703537772, -4.8863307637891555],
    [9.200000000000003, 7.0816294362172805, -4.8863307637891555],
    [9.199999999999996, 7.081638862599673, -4.938788715035749],
    [9.199999999999996, 7.134101215951064, -4.938788715035749],
    [9.199999999999996, 7.186563569302576, -4.938788715035749],
    [9.199999999999989, 7.1865729006919565, -4.991246571314338],
    [9.199999999999989, 7.239035206555508, -4.991246571314338],
    [9.200000000000003, 7.239044490440163, -5.043704332625274],
    [9.200000000000003, 7.291506748815836, -5.043704332625274],
    [9.200000000000003, 7.343969007191394, -5.043704332625274],
    [9.199999999999996, 7.343978196083734, -5.096161998968726],
    [9.199999999999996, 7.396440406971619, -5.096161998968726],
    [9.199999999999989, 7.396449548359401, -5.148619570345048],
    [9.199999999999989, 7.44891171175958, -5.148619570345048],
    [9.199999999999996, 7.448920805643342, -5.2010770467544365],
    [9.199999999999996, 7.501382921555901, -5.2010770467544365],
    [9.199999999999996, 7.50139196793562, -5.253534428197116],
    [9.199999999999996, 7.5538540363606455, -5.253534428197116],
    [9.199999999999996, 7.606316104785556, -5.253534428197116],
    [9.200000000000003, 7.60632505617413, -5.305991714673386],
    [9.200000000000003, 7.6587870771117075, -5.305991714673386],
    [9.199999999999996, 7.658795980996635, -5.358448906183556],
    [9.199999999999996, 7.711257954446854, -5.358448906183556],
    [9.199999999999989, 7.711266810828247, -5.410906002727836],
    [9.199999999999989, 7.763728736791194, -5.410906002727836],
    [9.199999999999996, 7.763737545669466, -5.463363004306429],
    [9.199999999999996, 7.816199424145221, -5.463363004306429],
    [9.199999999999996, 7.816208185520482, -5.515819910919694],
    [9.199999999999996, 7.868670016509137, -5.515819910919694],
    [9.200000000000003, 7.868678730381594, -5.568276722567791],
    [9.200000000000003, 7.921140513883115, -5.568276722567791],
    [9.200000000000003, 7.9211491802527725, -5.620733439251083],
    [9.200000000000003, 7.97361091626736, -5.620733439251083],
    [9.200000000000003, 8.02607265228207, -5.620733439251083],
    [9.200000000000003, 8.026081223662368, -5.673190060969766],
    [9.199999999999996, 8.026089795027222, -5.725646587724055],
    [9.199999999999996, 8.078551436068206, -5.725646587724055],
    [9.20000000000001, 8.078559959930876, -5.778103019514254],
    [9.20000000000001, 8.131021553485304, -5.778103019514254],
    [9.200000000000003, 8.131030029845794, -5.830559356340733],
    [9.200000000000003, 8.183491575913637, -5.830559356340733],
    [9.199999999999996, 8.183500004772316, -5.883015598203533],
    [9.199999999999996, 8.23596150335366, -5.883015598203533],
    [9.199999999999996, 8.235969884710663, -5.93547174510302],
    [9.199999999999996, 8.288431335805592, -5.93547174510302],
    [9.199999999999996, 8.288439669661097, -5.98792779703945],
    [9.199999999999996, 8.288448003501594, -6.040383754013189],
    [9.199999999999996, 8.34090935962395, -6.040383754013189],
    [9.199999999999996, 8.340917645963124, -6.09283961602428],
    [9.199999999999996, 8.393378954599324, -6.09283961602428],
    [9.200000000000003, 8.393387193437425, -6.14529538307309],
    [9.200000000000003, 8.445848454587555, -6.14529538307309],
    [9.199999999999989, 8.445856645924803, -6.197751055159929],
    [9.200000000000003, 8.445864837247209, -6.250206632285007],
    [9.200000000000003, 8.498326003425335, -6.250206632285007],
    [9.199999999999996, 8.498334147247181, -6.302662114448517],
    [9.199999999999996, 8.550795265939614, -6.302662114448517],
    [9.199999999999996, 8.55080336226092, -6.355117501650833],
    [9.199999999999996, 8.603264433467624, -6.355117501650833],
    [9.199999999999996, 8.603272482288586, -6.4075727938921],
    [9.199999999999996, 8.603280531095008, -6.460027991172693],
    [9.199999999999996, 8.655741507330395, -6.460027991172693],
    [9.199999999999996, 8.708202483565902, -6.460027991172693],
    [9.200000000000003, 8.708210437386835, -6.512483093492801],
    [9.199999999999996, 8.708218391193434, -6.564938100852639],
    [9.199999999999996, 8.760679272458086, -6.564938100852639],
    [9.199999999999996, 8.760687178764872, -6.61739301325251],
    [9.199999999999996, 8.813148012544227, -6.61739301325251],
    [9.200000000000003, 8.813155871351546, -6.669847830692738],
    [9.199999999999989, 8.813163730144607, -6.7223025531735265],
    [9.199999999999989, 8.865624468953506, -6.7223025531735265],
    [9.199999999999989, 8.918085207762525, -6.7223025531735265],
    [9.200000000000003, 8.918092971571255, -6.774757180695061],
    [9.200000000000003, 8.970553662895234, -6.774757180695061],
    [9.200000000000003, 8.97056137920513, -6.827211713257726],
    [9.200000000000003, 9.023022023044033, -6.827211713257726],
    [9.199999999999996, 9.023029691855033, -6.879666150861662],
    [9.200000000000003, 9.023037360651948, -6.932120493507245],
    [9.200000000000003, 9.075497909521328, -6.932120493507245],
    [9.200000000000003, 9.127958458390584, -6.932120493507245],
    [9.200000000000003, 9.127966032204485, -6.984574741194669],
    [9.200000000000003, 9.180426533589044, -6.984574741194669],
    [9.20000000000001, 9.180434059904568, -7.037028893924131],
    [9.20000000000001, 9.232894513804641, -7.037028893924131],
    [9.200000000000003, 9.232901992621892, -7.089482951695954],
    [9.200000000000003, 9.232909471425705, -7.141936914510526],
    [9.200000000000003, 9.285369830356695, -7.141936914510526],
    [9.200000000000003, 9.285377261662637, -7.194390782367842],
    [9.200000000000003, 9.337837573109276, -7.194390782367842],
    [9.200000000000003, 9.390297884556034, -7.194390782367842],
    [9.199999999999989, 9.39030522087987, -7.246844555268291],
    [9.20000000000001, 9.390312557190551, -7.29929823321212],
    [9.20000000000001, 9.442772773668864, -7.29929823321212],
    [9.199999999999996, 9.442780062482022, -7.351751816199747],
    [9.199999999999996, 9.495240231476243, -7.351751816199747],
    [9.199999999999996, 9.547700400470344, -7.351751816199747],
    [9.199999999999996, 9.54770759430243, -7.40420530423114],
    [9.199999999999996, 9.600167715812521, -7.40420530423114],
    [9.199999999999996, 9.600174862147671, -7.456658697306694],
    [9.199999999999996, 9.652634936173838, -7.456658697306694],
    [9.20000000000001, 9.652642035012274, -7.509111995426737],
    [9.199999999999996, 9.652649133837716, -7.561565198591473],
    [9.199999999999996, 9.705109112896299, -7.561565198591473],
    [9.200000000000003, 9.705116164225306, -7.614018306801068],
    [9.200000000000003, 9.757576095800223, -7.614018306801068],
    [9.200000000000003, 9.810036027375261, -7.614018306801068],
    [9.199999999999996, 9.810042983724289, -7.666471320055928],
    [9.199999999999996, 9.862502867815746, -7.666471320055928],
    [9.199999999999996, 9.862509776668624, -7.718924238356175],
    [9.200000000000003, 9.862516685509044, -7.771377061702204],
    [9.200000000000003, 9.914976474633606, -7.771377061702204],
    [9.200000000000003, 9.967436263758046, -7.771377061702204],
    [9.199999999999989, 9.967443077619453, -7.8238297900942],
    [9.199999999999989, 10.019902819260576, -7.8238297900942],
    [9.200000000000003, 10.019909585626351, -7.876282423532352],
    [9.200000000000003, 10.072369279784237, -7.876282423532352],
    [9.199999999999996, 10.072375998654614, -7.928734962016989],
    [9.199999999999996, 10.072382717512774, -7.981187405548439],
    [9.199999999999996, 10.124842316704568, -7.981187405548439],
    [9.200000000000003, 10.12484898806757, -8.033639754126895],
    [9.200000000000003, 10.17730853977627, -8.033639754126895],
    [9.200000000000003, 10.229768091485091, -8.033639754126895],
    [9.199999999999996, 10.229774667870185, -8.086092007752535],
    [9.199999999999996, 10.28223417209611, -8.086092007752535],
    [9.200000000000003, 10.282240700986566, -8.13854416642576],
    [9.200000000000003, 10.282247229865254, -8.19099623014669],
    [9.200000000000003, 10.334706639125535, -8.19099623014669],
    [9.20000000000001, 10.387172482287477, -8.243448198915727],
    [9.20000000000001, 10.43963184406513, -8.243448198915727],
    [9.200000000000003, 10.439638230472603, -8.295900072733051],
    [9.200000000000003, 10.49209754476771, -8.295900072733051],
    [9.200000000000003, 10.492103883681096, -8.348351851598848],
    [9.200000000000003, 10.54456315049374, -8.348351851598848],
    [9.199999999999996, 10.544569441913275, -8.400803535513452],
    [9.199999999999996, 10.597028661243545, -8.400803535513452],
    [9.199999999999989, 10.597034905169407, -8.453255124477273],
    [9.199999999999989, 10.649494077017508, -8.453255124477273],
    [9.199999999999996, 10.649500273449739, -8.50570661849026],
    [9.199999999999996, 10.701959397815637, -8.50570661849026],
    [9.199999999999996, 10.701965546754533, -8.558158017552826],
    [9.199999999999996, 10.754424623638318, -8.558158017552826],
    [9.199999999999996, 10.754430725084053, -8.610609321665223],
    [9.199999999999996, 10.806889754485802, -8.610609321665223],
    [9.199999999999996, 10.859348783887434, -8.610609321665223],
    [9.200000000000003, 10.859354790358356, -8.663060530827872],
    [9.200000000000003, 10.911813772278164, -8.663060530827872],
    [9.199999999999989, 10.91181973125623, -8.715511645040724],
    [9.199999999999989, 10.964278665694174, -8.715511645040724],
    [9.199999999999989, 11.016737600132, -8.715511645040724],
    [9.200000000000003, 11.016743464135853, -8.767962664304182],
    [9.200000000000003, 11.06920235109191, -8.767962664304182],
    [9.200000000000003, 11.069208167603534, -8.820413588618583],
    [9.200000000000003, 11.121667007077898, -8.820413588618583],
    [9.200000000000003, 11.121672776097256, -8.872864417984118],
    [9.200000000000003, 11.17413156809014, -8.872864417984118],
    [9.200000000000003, 11.226590360082906, -8.872864417984118],
    [9.199999999999996, 11.226596034128846, -8.925315152400959],
    [9.199999999999996, 11.279054778640097, -8.925315152400959],
    [9.199999999999996, 11.331513523151466, -8.925315152400959],
    [9.199999999999996, 11.33151910222424, -8.977765791869516],
    [9.199999999999996, 11.383977799254179, -8.977765791869516],
    [9.199999999999996, 11.38398333083543, -9.030216336389888],
    [9.199999999999996, 11.436441980384025, -9.030216336389888],
    [9.199999999999996, 11.488900629932623, -9.030216336389888],
    [9.199999999999996, 11.488906066541286, -9.082666785962505],
    [9.199999999999996, 11.54136466860863, -9.082666785962505],
    [9.199999999999996, 11.593823270675845, -9.082666785962505],
    [9.200000000000003, 11.593828612312583, -9.135117140587536],
    [9.200000000000003, 11.646287166898631, -9.135117140587536],
    [9.200000000000003, 11.698745721484798, -9.135117140587536],
    [9.200000000000003, 11.698750968149497, -9.187567400265154],
    [9.200000000000003, 11.751209475254578, -9.187567400265154],
    [9.200000000000003, 11.803667982359663, -9.187567400265154],
    [9.199999999999996, 11.803673134052861, -9.240017564995705],
    [9.199999999999996, 11.856131593676942, -9.240017564995705],
    [9.200000000000003, 11.856136697879982, -9.292467634779523],
    [9.200000000000003, 11.908595110023153, -9.292467634779523],
    [9.200000000000003, 11.9610535221662, -9.292467634779523],
    [9.200000000000003, 12.01351193430937, -9.292467634779523],
    [9.200000000000003, 12.06597034645242, -9.292467634779523],
    [9.200000000000003, 12.065975260722894, -9.344917609616797],
    [9.200000000000003, 12.11843362538524, -9.344917609616797],
    [9.200000000000003, 12.17089199004746, -9.344917609616797],
    [9.200000000000003, 12.170896809347607, -9.397367489507687],
    [9.200000000000003, 12.22335512652909, -9.397367489507687],
    [9.200000000000003, 12.275813443710689, -9.397367489507687],
    [9.200000000000003, 12.328271760892168, -9.397367489507687],
    [9.200000000000003, 12.38073007807377, -9.397367489507687],
    [9.200000000000003, 12.380734707442533, -9.449817274452622],
    [9.200000000000003, 12.433192977143477, -9.449817274452622],
    [9.199999999999996, 12.433197559023329, -9.502266964451687],
    [9.199999999999996, 12.485655781243583, -9.502266964451687],
    [9.199999999999996, 12.538114003463956, -9.502266964451687],
    [9.199999999999996, 12.590572225684213, -9.502266964451687],
    [9.200000000000003, 12.590576665114266, -9.554716559505328],
    [9.200000000000003, 12.643034839854035, -9.554716559505328],
    [9.200000000000003, 12.643039231795793, -9.607166059613693],
    [9.200000000000003, 12.695497359055167, -9.607166059613693],
    [9.200000000000003, 12.747955486314657, -9.607166059613693],
    [9.200000000000003, 12.80041361357415, -9.607166059613693],
    [9.200000000000003, 12.852871740833525, -9.607166059613693],
    [9.199999999999996, 12.852875942845992, -9.659615464776966],
    [9.200000000000003, 12.852880144850737, -9.71206477499549],
    [9.200000000000003, 12.905338177149693, -9.71206477499549],
    [9.200000000000003, 12.957796209448526, -9.71206477499549],
    [9.200000000000003, 13.010254241747482, -9.71206477499549],
    [9.199999999999996, 13.01025830130424, -9.764513990269707],
    [9.199999999999996, 13.062716286123056, -9.764513990269707],
    [9.199999999999996, 13.115174270941875, -9.764513990269707],
    [9.200000000000003, 13.115178235531133, -9.816963110599506],
    [9.200000000000003, 13.167636172869894, -9.816963110599506],
    [9.200000000000003, 13.220094110208535, -9.816963110599506],
    [9.200000000000003, 13.272552047547295, -9.816963110599506],
    [9.20000000000001, 13.272555869689473, -9.869412135985328],
    [9.20000000000001, 13.325013759548265, -9.869412135985328],
    [9.199999999999996, 13.325017534203635, -9.921861066427427],
    [9.199999999999996, 13.377475376582547, -9.921861066427427],
    [9.199999999999996, 13.429933218961459, -9.921861066427427],
    [9.199999999999996, 13.482391061340248, -9.921861066427427],
    [9.199999999999996, 13.534848903719158, -9.921861066427427],
    [9.199999999999996, 13.587306746097948, -9.921861066427427],
    [9.199999999999996, 13.587310283347687, -9.974309901926258],
    [9.199999999999996, 13.639768078246682, -9.974309901926258],
    [9.199999999999996, 13.692225873145796, -9.974309901926258],
    [9.199999999999996, 13.744683668044791, -9.974309901926258],
    [9.199999999999996, 13.797141462943905, -9.974309901926258],
    [9.199999999999996, 13.84959925784302, -9.974309901926258],
    [9.199999999999996, 13.902057052742014, -9.974309901926258],
    [9.199999999999996, 13.954514847641128, -9.974309901926258],
    [9.199999999999996, 14.006972642540124, -9.974309901926258],
    [9.199999999999996, 14.059430437439238, -9.974309901926258],
    [9.200000000000003, 14.059433547365, -10.026758642481699],
    [9.200000000000003, 14.111891294784407, -10.026758642481699],
    [9.200000000000003, 14.164349042203689, -10.026758642481699],
    [9.200000000000003, 14.216806789623094, -10.026758642481699],
    [9.200000000000003, 14.269264537042378, -10.026758642481699],
    [9.200000000000003, 14.321722284461782, -10.026758642481699],
    [9.200000000000003, 14.374180031881187, -10.026758642481699],
    [9.200000000000003, 14.42663777930047, -10.026758642481699],
    [9.200000000000003, 14.479095526719876, -10.026758642481699],
    [9.200000000000003, 14.53155327413916, -10.026758642481699],
    [9.200000000000003, 14.584011021558561, -10.026758642481699],
    [9.200000000000003, 14.63646876897785, -10.026758642481699],
    [9.200000000000003, 14.688926516397252, -10.026758642481699],
    [9.200000000000003, 14.741384263816537, -10.026758642481699],
    [9.200000000000003, 14.79384201123594, -10.026758642481699],
    [9.200000000000003, 14.846299758655343, -10.026758642481699],
    [9.200000000000003, 14.898757506074631, -10.026758642481699],
    [9.200000000000003, 14.951215253494034, -10.026758642481699],
    [9.200000000000003, 15.003673000913318, -10.026758642481699],
    [9.200000000000003, 15.056130748332723, -10.026758642481699],
    [9.200000000000003, 15.108588495752006, -10.026758642481699],
    [9.200000000000003, 15.161046243171413, -10.026758642481699],
    [9.200000000000003, 15.213503990590695, -10.026758642481699],
    [9.200000000000003, 15.265961738010098, -10.026758642481699],
    [9.200000000000003, 15.318419485429503, -10.026758642481699],
    [9.200000000000003, 15.370877232848787, -10.026758642481699],
    [9.200000000000003, 15.423334980268192, -10.026758642481699],
    [9.199999999999996, 15.423333104814787, -9.974309901926258],
    [9.199999999999996, 15.475790899713902, -9.974309901926258],
    [9.199999999999996, 15.528248694612897, -9.974309901926258],
    [9.199999999999996, 15.58070648951201, -9.974309901926258],
    [9.199999999999996, 15.633164284411006, -9.974309901926258],
    [9.199999999999996, 15.68562207931012, -9.974309901926258],
    [9.199999999999996, 15.685620441252205, -9.921861066427427],
    [9.199999999999996, 15.738078283631115, -9.921861066427427],
    [9.199999999999996, 15.790536126009906, -9.921861066427427],
    [9.199999999999996, 15.842993968388818, -9.921861066427427],
    [9.20000000000001, 15.842992472767683, -9.869412135985328],
    [9.20000000000001, 15.895450362626475, -9.869412135985328],
    [9.20000000000001, 15.94790825248515, -9.869412135985328],
    [9.20000000000001, 16.000366142343942, -9.869412135985328],
    [9.20000000000001, 16.052824032202732, -9.869412135985328],
    [9.20000000000001, 16.10528192206141, -9.869412135985328],
    [9.20000000000001, 16.157739811920198, -9.869412135985328],
    [9.200000000000003, 16.157738601176167, -9.816963110599506],
    [9.200000000000003, 16.21019653851493, -9.816963110599506],
    [9.200000000000003, 16.26265447585357, -9.816963110599506],
    [9.200000000000003, 16.31511241319233, -9.816963110599506],
    [9.200000000000003, 16.367570350530976, -9.816963110599506],
    [9.199999999999996, 16.367569329705088, -9.764513990269707],
    [9.199999999999996, 16.420027314523782, -9.764513990269707],
    [9.199999999999996, 16.472485299342594, -9.764513990269707],
    [9.199999999999996, 16.524943284161292, -9.764513990269707],
    [9.200000000000003, 16.524942405773867, -9.71206477499549],
    [9.200000000000003, 16.577400438072704, -9.71206477499549],
    [9.200000000000003, 16.629858470371655, -9.71206477499549],
    [9.199999999999996, 16.629857686943087, -9.659615464776966],
    [9.199999999999996, 16.682315766722265, -9.659615464776966],
    [9.199999999999996, 16.73477384650145, -9.659615464776966],
    [9.200000000000003, 16.734773158032084, -9.607166059613693],
    [9.200000000000003, 16.78723128529158, -9.607166059613693],
    [9.200000000000003, 16.839689412550953, -9.607166059613693],
    [9.200000000000003, 16.892147539810445, -9.607166059613693],
    [9.200000000000003, 16.8921469937809, -9.554716559505328],
    [9.200000000000003, 16.944605168520795, -9.554716559505328],
    [9.200000000000003, 16.997063343260567, -9.554716559505328],
    [9.199999999999996, 16.99706289219126, -9.502266964451687],
    [9.199999999999996, 17.04952111441151, -9.502266964451687],
    [9.200000000000003, 17.049520710821948, -9.449817274452622],
    [9.200000000000003, 17.101978980522773, -9.449817274452622],
    [9.200000000000003, 17.154437250223715, -9.449817274452622],
    [9.200000000000003, 17.20689551992454, -9.449817274452622],
    [9.200000000000003, 17.20689525877609, -9.397367489507687],
    [9.200000000000003, 17.259353575957565, -9.397367489507687],
    [9.200000000000003, 17.25935336228951, -9.344917609616797],
    [9.200000000000003, 17.311811726951735, -9.344917609616797],
    [9.200000000000003, 17.364270091614074, -9.344917609616797],
    [9.200000000000003, 17.36426997290717, -9.292467634779523],
    [9.200000000000003, 17.41672838505034, -9.292467634779523],
    [9.199999999999996, 17.416728313824006, -9.240017564995705],
    [9.199999999999996, 17.46918677344809, -9.240017564995705],
    [9.200000000000003, 17.46918674970275, -9.187567400265154],
    [9.200000000000003, 17.521645256807833, -9.187567400265154],
    [9.200000000000003, 17.5741037639128, -9.187567400265154],
    [9.200000000000003, 17.574103835129705, -9.135117140587536],
    [9.200000000000003, 17.626562389715755, -9.135117140587536],
    [9.199999999999996, 17.626562508413834, -9.082666785962505],
    [9.199999999999996, 17.679021110481056, -9.082666785962505],
    [9.199999999999996, 17.679021276660738, -9.030216336389888],
    [9.199999999999996, 17.679021442840607, -8.977765791869516],
    [9.199999999999996, 17.731480139870545, -8.977765791869516],
    [9.199999999999996, 17.783938836900365, -8.977765791869516],
    [9.199999999999996, 17.783939098043376, -8.925315152400959],
    [9.199999999999996, 17.83639784255463, -8.925315152400959],
    [9.200000000000003, 17.83639815117976, -8.872864417984118],
    [9.200000000000003, 17.83639845980533, -8.820413588618583],
    [9.200000000000003, 17.888857299279817, -8.820413588618583],
    [9.200000000000003, 17.8888576553875, -8.767962664304182],
    [9.200000000000003, 17.941316542343674, -8.767962664304182],
    [9.199999999999989, 17.94131694593391, -8.715511645040724],
    [9.199999999999989, 17.99377588037186, -8.715511645040724],
    [9.200000000000003, 17.993776331444685, -8.663060530827872],
    [9.199999999999996, 17.993776782518307, -8.610609321665223],
    [9.199999999999996, 18.04623581191994, -8.610609321665223],
    [9.199999999999996, 18.04623631047655, -8.558158017552826],
    [9.199999999999996, 18.09869538736021, -8.558158017552826],
    [9.199999999999996, 18.09869593339984, -8.50570661849026],
    [9.199999999999996, 18.15115505776562, -8.50570661849026],
    [9.199999999999989, 18.15115565128844, -8.453255124477273],
    [9.199999999999996, 18.15115624481208, -8.400803535513452],
    [9.200000000000003, 18.151156838336927, -8.348351851598848],
    [9.200000000000003, 18.203616105149692, -8.348351851598848],
    [9.200000000000003, 18.203616746158076, -8.295900072733051],
    [9.200000000000003, 18.256076060453307, -8.295900072733051],
    [9.20000000000001, 18.256076748945265, -8.243448198915727],
    [9.20000000000001, 18.308536110723033, -8.243448198915727],
    [9.200000000000003, 18.308536846699, -8.190996230146688],
    [9.200000000000003, 18.30853758267643, -8.13854416642576],
    [9.200000000000003, 18.36099703941943, -8.13854416642576],
    [9.199999999999996, 18.360997822880854, -8.086092007752535],
    [9.199999999999996, 18.413457327106663, -8.086092007752535],
    [9.200000000000003, 18.413458158052535, -8.033639754126895],
    [9.200000000000003, 18.465917709761236, -8.033639754126895],
    [9.199999999999996, 18.465918588191577, -7.981187405548438],
    [9.199999999999996, 18.465919466623262, -7.928734962016988],
    [9.199999999999996, 18.51837911329812, -7.928734962016988],
    [9.200000000000003, 18.518380039214684, -7.876282423532351],
    [9.199999999999989, 18.518380965133037, -7.823829790094199],
    [9.199999999999989, 18.570840706774163, -7.823829790094199],
    [9.200000000000003, 18.570841680177377, -7.7713770617022035],
    [9.199999999999996, 18.570842653582364, -7.718924238356173],
    [9.199999999999996, 18.62330249019033, -7.718924238356173],
    [9.199999999999996, 18.623303511080582, -7.666471320055927],
    [9.199999999999996, 18.67576339517204, -7.666471320055927],
    [9.200000000000003, 18.675764463547576, -7.614018306801067],
    [9.199999999999996, 18.67576553192531, -7.561565198591472],
    [9.20000000000001, 18.675766600304843, -7.5091119954267365],
    [9.20000000000001, 18.7282266268473, -7.5091119954267365],
    [9.199999999999996, 18.72822774271247, -7.456658697306693],
    [9.199999999999996, 18.728228858579808, -7.404205304231139],
    [9.199999999999996, 18.78068898009002, -7.404205304231139],
    [9.199999999999996, 18.780690143443387, -7.351751816199746],
    [9.20000000000001, 18.780691306798822, -7.299298233212119],
    [9.20000000000001, 18.833151523277014, -7.299298233212119],
    [9.199999999999989, 18.833152734118894, -7.24684455526829],
    [9.199999999999989, 18.885612998081264, -7.24684455526829],
    [9.200000000000003, 18.885614256409596, -7.194390782367841],
    [9.200000000000003, 18.885615514740095, -7.141936914510525],
    [9.200000000000003, 18.885616773072826, -7.089482951695953],
    [9.200000000000003, 18.938077179488253, -7.089482951695953],
    [9.20000000000001, 18.938078485307948, -7.03702889392413],
    [9.200000000000003, 18.938079791129883, -6.984574741194668],
    [9.200000000000003, 18.938081096954164, -6.932120493507244],
    [9.200000000000003, 18.99054164582342, -6.932120493507244],
    [9.199999999999996, 18.990542999134973, -6.879666150861661],
    [9.200000000000003, 18.990544352448868, -6.827211713257725],
    [9.200000000000003, 18.990545705765072, -6.77475718069506],
    [9.200000000000003, 19.04300639708905, -6.77475718069506],
    [9.199999999999989, 19.043007797892887, -6.722302553173526],
    [9.200000000000003, 19.043009198699366, -6.669847830692737],
    [9.200000000000003, 19.09546998499339, -6.669847830692737],
    [9.199999999999996, 19.095471433287486, -6.617393013252509],
    [9.199999999999996, 19.09547288158423, -6.564938100852638],
    [9.200000000000003, 19.09547432988371, -6.512483093492801],
    [9.199999999999996, 19.095475778185556, -6.4600279911726926],
    [9.199999999999996, 19.095477226490264, -6.407572793892099],
    [9.199999999999996, 19.147938250211205, -6.407572793892099],
    [9.199999999999996, 19.147939746004198, -6.355117501650832],
    [9.199999999999996, 19.147941241799632, -6.302662114448516],
    [9.200000000000003, 19.14794273759804, -6.250206632285006],
    [9.199999999999989, 19.147944233399013, -6.197751055159928],
    [9.200000000000003, 19.147945729202572, -6.145295383073089],
    [9.200000000000003, 19.2004069903527, -6.145295383073089],
    [9.199999999999996, 19.200408533645184, -6.092839616024278],
    [9.199999999999996, 19.200410076940578, -6.040383754013188],
    [9.199999999999996, 19.200411620238487, -5.9879277970394496],
    [9.199999999999996, 19.20041316353947, -5.935471745103019],
    [9.199999999999996, 19.252874614634276, -5.935471745103019],
    [9.199999999999996, 19.305337704005694, -5.883015598203532],
    [9.200000000000003, 19.30533934228527, -5.830559356340732],
    [9.20000000000001, 19.305340980567525, -5.778103019514253],
    [9.199999999999996, 19.30534261885303, -5.7256465877240545],
    [9.200000000000003, 19.305344257141382, -5.673190060969765],
    [9.200000000000003, 19.357805945669245, -5.673190060969765],
    [9.200000000000003, 19.35780763144726, -5.620733439251082],
    [9.200000000000003, 19.35780931722845, -5.5682767225677905],
    [9.199999999999996, 19.35781100301284, -5.515819910919693],
    [9.199999999999996, 19.410272834001375, -5.515819910919693],
    [9.199999999999996, 19.410274567275767, -5.463363004306428],
    [9.199999999999989, 19.410276300553328, -5.410906002727835],
    [9.199999999999996, 19.410278033834125, -5.358448906183555],
    [9.200000000000003, 19.41027976711781, -5.305991714673385],
    [9.200000000000003, 19.46274178805539, -5.305991714673385],
    [9.199999999999996, 19.46274356882981, -5.253534428197115],
    [9.199999999999996, 19.46274534960757, -5.201077046754436],
    [9.199999999999989, 19.46274713038829, -5.148619570345047],
    [9.199999999999989, 19.51520929378847, -5.148619570345047],
    [9.199999999999996, 19.515211122060247, -5.096161998968725],
    [9.200000000000003, 19.515212950335474, -5.043704332625273],
    [9.199999999999989, 19.51521477861374, -4.9912465713143375],
    [9.199999999999996, 19.515216606895464, -4.938788715035748],
    [9.200000000000003, 19.515218435180596, -4.886330763789154],
    [9.199999999999996, 19.515220263468795, -4.833872717574354],
    [9.199999999999996, 19.515222091760567, -4.781414576391123],
    [9.200000000000003, 19.51522392005553, -4.728956340239163],
    [9.199999999999996, 19.515225748353757, -4.676498009118134],
    [9.199999999999996, 19.51522757665534, -4.624039583027943],
    [9.199999999999996, 19.515229404960234, -4.571581061968248],
    [9.199999999999996, 19.567692090729892, -4.571581061968248],
    [9.199999999999996, 19.567693966526747, -4.519122445938793],
    [9.199999999999989, 19.56769584232695, -4.466663734939235],
    [9.20000000000001, 19.567697718130592, -4.4142049289694825],
    [9.199999999999996, 19.567699593937757, -4.361746028029198],
    [9.200000000000003, 19.567701469748044, -4.30928703211808],
    [9.200000000000003, 19.567703345561977, -4.256827941235911],
    [9.199999999999996, 19.567705221379207, -4.204368755382474],
    [9.20000000000001, 19.567707097199804, -4.151909474557432],
    [9.199999999999996, 19.567708973023827, -4.099450098760606],
    [9.199999999999996, 19.567710848851227, -4.046990627991657],
    [9.200000000000003, 19.567712724682007, -3.994531062250372]
  ]
leftLineIdxs, rightLineIdxs = [1042, 1053, 1073, 1074, 1083, 1098, 1118, 1119, 1139, 1140, 1143, 1589, 1632, 1845, 1853, 1965, 1989, 2010, 2011, 2707, 2709, 2782, 2783, 2853, 2897, 2902, 2904, 2915, 2916, 3045, 3076, 3128, 3202, 3203, 3252, 3253, 3267, 3328, 3341], [20, 22, 37, 38, 40, 46, 59, 67, 69, 81, 109, 110, 115, 119, 337, 338, 343, 613, 834, 835, 864, 1005, 1030, 2039, 2121, 2122, 2198, 2226, 2246, 2247, 2249, 2487, 2488, 2489, 2517, 2579, 2580, 2646]
eigenVectors = read_matrix_from_hdf5('eigenVectors.h5')
mean = read_matrix_from_hdf5('mean.h5')

df_lines = pd.read_csv('lines.txt', sep=' ', header=None)

eigenValuesAugmentation_fit = [37.47394805, -49.07828283,  -0.6562043,  -24.62020633, -27.13628352, 6.57057748, -11.42703975, -18.79096601, -10.54424185, 3.44637848, -12.89579981, -7.87242574, -13.9092693, 2.27681137, -7.3060829, -7.73122333, -4.43121648, 5.80548907, 10.15422231, 14.24570948, -17.25150115, 0.97727416, -3.08962112, 5.8461985, 6.87403008, -3.17929581, 1.36895233, -0.74191196, -0.60536829, 5.94243889]
eigenValuesHgcutc_fit = [66.5102204, -24.76411345, 1.70376424, 2.92133485, -6.9323176, -1.48699708, -35.35894094, -5.41287126, -1.88989772, -17.37732512, -9.51820522, -6.22233237, -8.54547095, -9.16200286, -2.39652577, -2.43217571, -2.04571966, 9.26675976, 4.26537572, -7.24458967, 2.15155003, 4.1990664, 6.5805836, 4.16409486, 4.25174997, -1.03743915, -12.91132593, -2.45534336, 0.50039155, 2.90791843]
class Minimizer():
    def __init__(self, x0, line, baseParams, maxiter):
        self.x0 = x0
        self.line = line
        self.baseParams = baseParams
        self.maxiter = maxiter
        
    def fun(self, x):
        self.baseParams[1] = x[0]
        self.baseParams[2] = x[1]
        self.baseParams[3] = x[2]
        self.baseParams[4] = x[3]
        self.baseParams[5] = x[4]
        self.baseParams[6] = x[5]
        self.baseParams[7] = x[6]
        #self.baseParams[8] = x[7]
        #self.baseParams[9] = x[8]
        #self.baseParams[10] = x[9]
        #self.baseParams[11] = x[10]
        #self.baseParams[12] = x[11]
        model = calcSpecificModel(self.baseParams, mean, eigenVectors)
        idxs = expandIndices(rightLineIdxs)
        sum = 0
        for i in range(0,len(idxs),3):
            minDist = 100000000
            for v in self.line:
                dist = np.sqrt((model[idxs[i]] - v[0])**2 + (model[idxs[i+1]] - v[1])**2 + (model[idxs[i+2]] - v[2])**2)
                if dist < minDist:
                    minDist = dist
            sum += minDist
        return sum
    
    def run(self):
        print('f(x0): ', self.fun(self.x0))
        res = minimize(self.fun, self.x0, method='L-BFGS-B', options={'maxiter': self.maxiter})
        print('loss: ', res.fun)
        #print('x: ', res.x[0], ' ', res.x[1], ' ', res.x[2])
        return res

def fun(x):
    if False:
        eigenValuesAugmentation_fit[1] = x[0]
        eigenValuesAugmentation_fit[2] = x[1]
        eigenValuesAugmentation_fit[3] = x[2]
        eigenValuesAugmentation_fit[4] = x[3]
        eigenValuesAugmentation_fit[5] = x[4]
        eigenValuesAugmentation_fit[6] = x[5]
        eigenValuesAugmentation_fit[7] = x[6]
        eigenValuesAugmentation_fit[8] = x[7]
        eigenValuesAugmentation_fit[9] = x[8]
        model = calcSpecificModel(eigenValuesAugmentation_fit, mean, eigenVectors)
        idxs = expandIndices(rightLineIdxs)
        sum = 0
        global line
        for i in range(0,len(idxs),3):
                    sum += np.sqrt((model[idxs[i]] - line[i])**2 + (model[idxs[i+1]] - line[i+1])**2 + (model[idxs[i+2]] - line[i+2])**2)

        return sum

x0 = [-24.76411345, 1.70376424, 2.92133485, -6.9323176, -1.48699708, -35.35894094, -5.41287126, -1.88989772, -17.37732512, -9.51820522, -6.22233237, -8.54547095]

def testAll():
    results = []
    f = open('results.txt', 'w')
    for i in range(49):
        line = toTuple(df_lines.values[0])
        t = time.time()
        minobj = Minimizer(x0, sampleline, eigenValuesHgcutc_fit, i+1)
        loss = minobj.run()
        elapsed = time.time() - t
        print('time elapsed: ', elapsed, ' with maxiter: ', i+1)
        results.append((elapsed, loss.fun))
    f.write(str(results))
    f.close()

def saveToFile(list):
    f = open('modelParams.txt', 'w')
    string = ''
    for i in list:
        string += str(i) + ' '
    f.write(string)
    f.close()
    
def testOne():
    results = []
    f = open('results.txt', 'w')
    t = time.time()
    minobj = Minimizer(x0, sampleline, eigenValuesHgcutc_fit, 10)
    loss = minobj.run()
    elapsed = time.time() - t
    print('time elapsed: ', elapsed, ' with maxiter: ', 10)
    results.append((elapsed, loss.fun))
    f.write(str(results))
    f.close()

def main():
    testOne()
        

if __name__ == '__main__':
    main()